metadata:
  name: "Check that Dynamo DB has configured into VPC endpoint gateway"
  id: "CKV2_AWS_124"
  category: "GENERAL_SECURITY"
definition:
  and:
    - cond_type: "filter"
      attribute: "resource_type"
      value:
        - AWS::DynamoDB::Table
      operator: within
    - cond_type: "connection"
      resource_types:
        - AWS::DynamoDB::Table
      connected_resource_types:
        - AWS::EC2::VPCEndpoint
      operator: exists
    - and:
        - cond_type: attribute
          attribute: RouteTableIds
          operator: exists
          resource_types:
            - AWS::EC2::VPCEndpoint
        - cond_type: attribute
          attribute: ServiceName
          operator: regex_match
          value: .*com.amazonaws*.*dynamodb*.
          resource_types:
            - AWS::EC2::VPCEndpoint
