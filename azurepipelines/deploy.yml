steps:


- task: UsePythonVersion@0
  displayName: 'Use Python'
  inputs:
    versionSpec: '>= 3.6'
  enabled: false

- task: versioner@1
  displayName: 'Version v'

- script: |
    python3 -m pip install --upgrade pip -i $(ARTIFACTORY_URL) --trusted-host $(ARTIFACTORY_HOST)
    python3 -m pip install setuptools virtualenv wheel -i $(ARTIFACTORY_URL) --trusted-host $(ARTIFACTORY_HOST)
    python3 -m virtualenv _venv
    source _venv/bin/activate
    python -m pip install -r requirements.txt -i $(ARTIFACTORY_URL) --trusted-host $(ARTIFACTORY_HOST)
    python3 setup.py bdist_wheel
  workingDirectory: $(System.DefaultWorkingDirectory)/$(componentName)
  displayName: 'Artifact creation'

- task: ArtifactoryGenericUpload@2
  displayName: "Artifactory Generic Upload Qa"
  inputs:
    artifactoryService: Artifactory
    fileSpec: |
      {
        "files": [
          {
            "pattern": "$(System.DefaultWorkingDirectory)/$(componentName)/*.whl",
            "target": "$(url_repository_artifactory_qa)/"
          }
        ]
      }

- task: ArtifactoryGenericUpload@2
  displayName: "Artifactory Generic Upload Pdn"
  inputs:
    artifactoryService: Artifactory
    fileSpec: |
      {
        "files": [
          {
            "pattern": "$(System.DefaultWorkingDirectory)/$(componentName)/*.whl",
            "target": "common-pypi/devsecops_engine_utilities/$(tag.version)/"
          }
        ]
      }
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/trunk'))
